nameOverride: ""

existingConfigMap: ""
configMapName: secretsync-config

# Legacy config format (operator mode)
config: {}

# =============================================================================
# Pipeline Configuration (NEW)
# =============================================================================
# Unified pipeline configuration for multi-account secrets management.
# Works identically via CLI, Kubernetes operator, or Helm.
#
# Operations:
#   - merge:    Source stores → Merge store (with inheritance)
#   - sync:     Merge store → AWS Secrets Manager
#   - pipeline: merge + sync in dependency order

pipeline:
  # Enable pipeline mode (uses new unified config format)
  enabled: false
  
  # Pipeline configuration (inline or reference existing ConfigMap)
  # existingConfigMap: my-pipeline-config
  
  config: {}
  # Example pipeline configuration:
  # config:
  #   vault:
  #     address: https://vault.example.com/
  #     namespace: eng/data-platform
  #     auth:
  #       approle:
  #         role_id: ${VAULT_ROLE_ID}
  #         secret_id: ${VAULT_SECRET_ID}
  #   
  #   aws:
  #     region: us-east-1
  #     execution_context:
  #       type: delegated_admin
  #       account_id: "123456789012"
  #     control_tower:
  #       enabled: true
  #       execution_role:
  #         name: AWSControlTowerExecution
  #   
  #   sources:
  #     analytics:
  #       vault:
  #         mount: analytics
  #     analytics-engineers:
  #       vault:
  #         mount: analytics-engineers
  #   
  #   merge_store:
  #     vault:
  #       mount: merged-secrets
  #   
  #   targets:
  #     Serverless_Stg:
  #       account_id: "111111111111"
  #       imports:
  #         - analytics
  #         - analytics-engineers
  #     Serverless_Prod:
  #       account_id: "222222222222"
  #       imports:
  #         - Serverless_Stg  # Inherits from Stg
  #   
  #   pipeline:
  #     merge:
  #       parallel: 4
  #     sync:
  #       parallel: 4
  #       delete_orphans: false

  # Schedule for automatic pipeline runs (cron format)
  # Leave empty to disable scheduled runs
  schedule: ""
  # schedule: "0,30 * * * *"  # Every 30 minutes
  
  # Default operation when triggered
  operation: pipeline  # merge, sync, or pipeline
  
  # Continue processing even if some targets fail
  continueOnError: true
# # The log level for the application. Can be one of "debug", "info", "warn", "error", "fatal", or "panic".
# log:
#   level: "debug" # The log level for the application. Can be one of "debug", "info", "warn", "error", "fatal", or "panic".
#   format: "json" # The format of the log output. Can be one of "json" or "text"
#   events: true # Whether to log events.

# # Configuration for the event server.
# events:
#   # Whether the event server is enabled.
#   enabled: true
#   # The port the event server listens on.
#   port: 8080
#   # Security settings for the event server.
#   security:
#     # Whether security is enabled for the event server.
#     enabled: true
#     # The token used for authentication.
#     token: "your-token"
#     # TLS configuration for the event server.
#     tls: 
#       certFile: "/path/to/certfile"
#       keyFile: "/path/to/keyfile"
#   # Whether to deduplicate events.
#   dedupe: true

# # Configuration for the operator.
# operator:
#   # Whether the operator is enabled.
#   enabled: true
#   # Backend configuration for the operator.
#   backend:
#     # The type of backend to use.
#     type: "your-backend-type"
#     # Parameters for the backend.
#     params:
#       param1: "value1"
#       param2: "value2"

# # Configuration for the stores.
# stores:
  # aws:
  #   region: "us-west-2"

  # github:
  #   installId: 12345
  #   appId: 67890
  #   privateKeyPath: "/path/to/private/key"

# # Configuration for the queue.
# queue:
#   # The type of queue to use.
#   type: "your-queue-type"
#   # Parameters for the queue.
#   params:
#     param1: "value1"
#     param2: "value2"

# # Configuration for the metrics server.
# metrics:
#   # The port the metrics server listens on.
#   port: 9090
#   # Security settings for the metrics server.
#   security:
#     # Whether security is enabled for the metrics server.
#     enabled: true
#     # The token used for authentication.
#     token: "your-token"
#     # TLS configuration for the metrics server.
#     tls: 
#       certFile: "/path/to/certfile"
#       keyFile: "/path/to/keyfile"

# notifications:
#   email:
#     enabled: true
#     host: "smtp.example.com"
#     port: 587
#     username: "your-email@example.com"
#     password: "your-email-password"
#     from: "your-email@example.com"
#     to: "recipient@example.com"
#     subject: "Notification Subject"
#     body: "This is the notification body."
#   slack:
#     enabled: true
#     url: "https://hooks.slack.com/services/YOUR_WORKSPACE/YOUR_CHANNEL/YOUR_TOKEN"
#     message: "This is the notification message."
#   webhook:
#     enabled: true
#     url: "https://example.com/webhook"
#     method: "POST"
#     headers:
#       Content-Type: "application/json"
#     body: |
#       {
#         "status": "{{ .Status }}",
#         "message": "{{ .Message }}"
#       }


secretsync-operator:
  enabled: true
  existingConfigMap: secretsync-config
  replicaCount: 1

  image:
    repository: docker.io/jbcom/secretsync
    pullPolicy: IfNotPresent
    # Overrides the image tag whose default is the chart appVersion.
    tag: ""

  imagePullSecrets: []

  serviceAccount:
    # Specifies whether a service account should be created
    create: true
    # Annotations to add to the service account
    annotations: {}
    # The name of the service account to use.
    # If not set and create is true, a name is generated using the fullname template
    name: ""

  rbac:
    # Specifies whether RBAC resources should be created
    create: true

  deploymentAnnotations: {}
  podAnnotations: {}

  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 65534  # nobody user
    runAsGroup: 65534
    fsGroup: 65534

  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: true
    runAsNonRoot: true
    runAsUser: 65534

  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi

  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 100
    targetCPUUtilizationPercentage: 80
    # targetMemoryUtilizationPercentage: 80

  nodeSelector: {}

  tolerations: []

  affinity: {}

  env: []
  envFrom: []
  extraVolumeMounts: []
  extraVolumes: []
  

secretsync-events:
  enabled: true
  existingConfigMap: secretsync-config
  replicaCount: 1

  image:
    repository: docker.io/jbcom/secretsync
    pullPolicy: IfNotPresent
    # Overrides the image tag whose default is the chart appVersion.
    tag: ""

  imagePullSecrets: []

  serviceAccount:
    # Specifies whether a service account should be created
    create: true
    # Annotations to add to the service account
    annotations: {}
    # The name of the service account to use.
    # If not set and create is true, a name is generated using the fullname template
    name: ""

  deploymentAnnotations: {}
  podAnnotations: {}

  podSecurityContext: {}
    # fsGroup: 2000

  securityContext: {}
    # capabilities:
    #   drop:
    #   - ALL
    # readOnlyRootFilesystem: true
    # runAsNonRoot: true
    # runAsUser: 1000

  containerPort: 8080

  service:
    type: ClusterIP
    port: 8080

  resources: {}
    # We usually recommend not to specify default resources and to leave this as a conscious
    # choice for the user. This also increases chances charts run on environments with little
    # resources, such as Minikube. If you do want to specify resources, uncomment the following
    # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
    # limits:
    #   cpu: 100m
    #   memory: 128Mi
    # requests:
    #   cpu: 100m
    #   memory: 128Mi

  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 100
    targetCPUUtilizationPercentage: 80
    # targetMemoryUtilizationPercentage: 80

  nodeSelector: {}

  tolerations: []

  affinity: {}

  env: []
  envFrom: []
  extraVolumeMounts: []
  extraVolumes: []